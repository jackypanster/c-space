### **产品需求文档：Windows C盘大文件清理工具**

#### 1. **目标 (Objective)**
开发一个命令行工具，用于扫描 Windows 11/10 系统的 C 盘，帮助用户识别并安全地删除占用空间大的非系统文件，以释放磁盘空间。

#### 2. **核心功能 (Core Features)**

##### 2.1. 文件扫描与发现 (File Scanning & Discovery)
- **扫描目标**: 默认扫描 `C:\` 盘。
- **文件筛选**:
    - 用户可以指定一个最小文件大小阈值（例如，通过命令行参数 `--min-size 100MB`）。
    - 若未指定，则使用默认值 `50MB`。
    - 只统计文件，忽略目录本身的大小。

##### 2.2. 排除规则 (Exclusion Rules - Safety First)
- **核心原则**: 安全性是最高优先级，绝不能引导用户删除可能导致系统或应用不稳定的文件。
- **默认排除目录**: **必须**默认跳过以下关键目录的扫描：
    - Windows 系统目录 (通过环境变量 `%windir%` 获取, 如 `C:\Windows`)
    - 程序安装目录 (`%ProgramFiles%`, `%ProgramFiles(x86)%`)
    - 用户及公共应用数据目录 (`%ProgramData%`, `%APPDATA%`, `%LOCALAPPDATA%`)
    - 系统特殊目录 (如 `$Recycle.Bin`, `System Volume Information`, `Config.Msi`)
- **默认排除文件属性**: **必须**自动跳过所有带有“系统 (System)”和“隐藏 (Hidden)”属性的文件，无论它们位于哪个目录。
- **(可选) 用户自定义排除**: 允许用户通过配置文件或命令行参数，添加额外的排除路径。

##### 2.3. 结果展示 (Result Display)
- **排序**: 扫描结果**必须**按文件大小**从大到小**进行降序排序。
- **数量限制**: 用户可以指定显示结果的数量（例如 `--top 20`）。若未指定，默认显示前 20 个。
- **格式化输出**:
    - 结果以清晰的表格形式展示，包含序号、文件大小和文件的完整绝对路径。
    - 文件大小需进行人性化格式化，自动选择最合适的单位（如 `2.51 GB`, `870.3 MB`），并保留1-2位小数。
    - **示例输出**:
      ```
      > 正在扫描 C:\ ... 扫描完成。
      > 发现超过 50MB 的文件共 35 个，显示前 20 个：

      #   大小        文件路径
      ----------------------------------------------------------------------
      1.  2.51 GB   C:\Users\YourUser\Downloads\ubuntu-22.04.iso
      2.  1.89 GB   C:\Temp\large_archive.zip
      3.  980.5 MB  C:\Users\YourUser\Documents\virtual_machine.vhd
      ...
      ```

##### 2.4. 交互式安全删除 (Interactive Safe Deletion)
- **操作流程**: 在结果列表展示完毕后，程序进入交互式删除模式。
- **逐一确认**: 程序从列表中的最大文件开始，逐一询问用户是否删除。
- **安全删除机制**: 删除操作**必须**为**移至系统回收站**，而不是永久删除。这为用户提供了撤销操作的机会。
- **用户指令**:
    - 输入 `y` 或 `yes` (不区分大小写): 确认删除，程序将文件移至回收站。
    - 输入 `n` 或 `no` (不区分大小写) 或直接按 **Enter**: 跳过当前文件，处理下一个。`n` 应为默认选项。
    - 输入 `q` 或 `quit` (不区分大小写): 退出删除流程，并终止程序。
- **错误处理**: 如果删除失败（例如文件被占用、权限不足），程序应向用户报告具体的错误信息，然后继续处理下一个文件。
- **示例交互**:
  ```
  开始交互式删除...
  [1] 删除 2.51 GB 的文件 'C:\Users\YourUser\Downloads\ubuntu-22.04.iso'? (y/N/q): y
  > 成功移至回收站。

  [2] 删除 1.89 GB 的文件 'C:\Temp\large_archive.zip'? (y/N/q): n
  > 已跳过。

  [3] 删除 980.5 MB 的文件 'C:\Users\YourUser\Documents\virtual_machine.vhd'? (y/N/q): y
  > 错误：删除失败，文件可能被其他程序占用。
  ...
  ```

#### 3. **非功能性需求 (Non-Functional Requirements)**
- **性能**: 扫描全盘可能耗时较长，程序在扫描期间应提供实时进度反馈（例如，打印当前正在扫描的目录）。
- **健壮性**: 程序启动时应检查目标驱动器（C盘）是否存在和可读，如果不可访问则给出明确错误提示并退出。
- **平台**: 主要为 Windows 11 设计，但应尽可能考虑兼容 Windows 10。

#### 4. **技术栈选型 (Technology Stack)**
- **推荐语言**: **Python 3**
    - **理由**: Python 拥有简洁的语法和强大的生态系统，能够快速、直接地实现所有核心功能。其跨平台特性良好，且在 Windows 上的支持非常成熟。
- **关键库依赖**:
    - **`os`, `sys`**: 用于文件系统遍历、路径处理和环境变量访问，是标准库的核心部分。
    - **`argparse`**: 用于解析命令行参数（如 `--min-size`, `--top`），创建用户友好的 CLI 界面。
    - **`send2trash`**: 用于实现安全的“移至回收站”功能。相比直接删除，此库提供了更安全的用户体验，完全符合需求。
- **分发方式**:
    - 开发完成后，建议使用 **PyInstaller** 或类似工具将 Python 脚本打包成单个独立的 `.exe` 可执行文件。这样用户无需安装 Python 环境即可直接运行，提升了工具的便携性和易用性。
